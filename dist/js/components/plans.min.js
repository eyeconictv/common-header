!function(e){"use strict";try{e.module("risevision.common.config")}catch(n){e.module("risevision.common.config",[])}e.module("risevision.common.components.plans.services",["risevision.store.authorization","risevision.common.gapi","risevision.common.currency"]),e.module("risevision.common.components.plans",["risevision.common.config","risevision.common.components.plans.services","risevision.common.components.purchase-flow","risevision.common.components.scrolling-list","risevision.common.components.loading","ui.bootstrap"])}(angular),function(e){"use strict";e.module("risevision.common.currency",["risevision.common.gapi"]).factory("currencyService",["$q","storeAPILoader","$log",function(e,n,t){var r=null,i={defaultItem:null},o=function(e){this.country=e.country,this.currencyCode=e.currencyCode,this.description=e.description,this.bankAccountCode=e.bankAccountCode,this.bankAccountDescription=e.bankAccountDescription,this.getName=function(){return this.currencyCode.toUpperCase()},this.pickPrice=function(e,n){switch(this.currencyCode.toUpperCase()){case"CAD":return n;default:return e}}};return i.getByCountry=function(e){if(e)for(var n=0;n<this.items.length;n++)if(this.items[n].country&&this.items[n].country.toUpperCase()===e.toUpperCase())return this.items[n];return this.defaultItem},i.setItems=function(e){this.items=[];for(var n=0;n<e.length;n++){var t=new o(e[n]);this.items.push(t),t.country||(this.defaultItem=t)}},function(){return null!==r?r.promise:(r=e.defer(),t.debug("currencyService called"),n().then(function(e){var n=e.currency.list();n.execute(function(e){t.debug("currencyService resp",e),e.error?(console.error("currencyService error: ",e.error),r.reject(e.error)):(i.setItems(e.items),r.resolve(i))})}),r.promise)}}])}(angular),function(e){"use strict";e.module("risevision.common.components.plans").factory("currentPlanFactory",["$log","$rootScope","$timeout","userState","PLANS_LIST",function(e,n,t,r,i){var o={},a=_.keyBy(i,"type"),c=_.keyBy(i,"productCode"),s=function(){var t=r.getCopyOfSelectedCompany(),i=null;t.id&&t.planProductCode?(i=_.cloneDeep(c[t.planProductCode]),i.status=t.planSubscriptionStatus,i.trialPeriod=t.planTrialPeriod,i.currentPeriodEndDate=new Date(t.planCurrentPeriodEndDate)):i=_.cloneDeep(a.free),o.currentPlan=i,i.playerProTotalLicenseCount=t.playerProTotalLicenseCount,i.playerProAvailableLicenseCount=t.playerProAvailableLicenseCount,i.shareCompanyPlan=t.shareCompanyPlan,t.parentPlanProductCode&&(i.parentPlan=_.cloneDeep(c[t.parentPlanProductCode])),i.isPurchasedByParent=!!t.planBillToId&&!!t.planShipToId&&t.planBillToId!==t.planShipToId&&(o.isSubscribed()||o.isCancelledActive()),i.parentPlanCompanyName=t.parentPlanCompanyName,i.parentPlanContactEmail=t.parentPlanContactEmail,e.debug("Current plan",i),n.$emit("risevision.plan.loaded",i)},l=function(){e.debug("Reloading current plan"),t(function(){r.reloadSelectedCompany().then(s)["catch"](function(n){e.error("Error reloading plan information",n)})["finally"](function(){e.debug("Finished reloading current plan")})},1e4)};return o.isPlanActive=function(){return o.isSubscribed()||o.isOnTrial()},o.isFree=function(){return"free"===o.currentPlan.type},o.isParentPlan=function(){return!!o.currentPlan.parentPlan},o.isEnterpriseSubCompany=function(){return"enterprisesub"===o.currentPlan.type},o.isSubscribed=function(){return!o.isFree()&&"Active"===o.currentPlan.status},o.isOnTrial=function(){return!o.isFree()&&"Trial"===o.currentPlan.status},o.isTrialExpired=function(){return!o.isFree()&&"Trial Expired"===o.currentPlan.status},o.isSuspended=function(){return!o.isFree()&&"Suspended"===o.currentPlan.status},o.isCancelled=function(){return!o.isFree()&&"Cancelled"===o.currentPlan.status},o.isCancelledActive=function(){var e=new Date;return o.isCancelled()&&o.currentPlan.currentPeriodEndDate>e},s(),n.$on("risevision.company.selectedCompanyChanged",function(){s()}),n.$on("risevision.company.updated",function(){s()}),n.$on("chargebee.subscriptionChanged",function(){l()}),n.$on("chargebee.subscriptionCancelled",function(){l()}),o}])}(angular),function(e){"use strict";e.module("risevision.common.components.plans").value("PLANS_LIST",[{name:"Free",type:"free",order:0,productId:"000",productCode:"000",status:"Active",proLicenseCount:0,monthly:{priceDisplayMonth:0,billAmount:0,save:0},yearly:{priceDisplayMonth:0,priceDisplayYear:0,billAmount:0,save:0}},{name:"Volume",type:"volume",order:1,productId:"2317",productCode:"34e8b511c4cc4c2affa68205cd1faaab427657dc",proLicenseCount:3,monthly:{priceDisplayMonth:10,billAmount:10,save:0},yearly:{priceDisplayMonth:10,priceDisplayYear:110,billAmount:110,save:10},trialPeriod:14,discountIndustries:["PRIMARY_SECONDARY_EDUCATION","HIGHER_EDUCATION","LIBRARIES","PHILANTHROPY","NON_PROFIT_ORGANIZATION_MANAGEMENT","RELIGIOUS_INSTITUTIONS"]},{name:"Starter",type:"starter",order:1,productId:"335",productCode:"019137f7bb35f5f90085a033c013672471faadae",proLicenseCount:1,monthly:{priceDisplayMonth:10,billAmount:10,save:0},yearly:{priceDisplayMonth:10,priceDisplayYear:110,billAmount:110,save:10},trialPeriod:14},{name:"Basic",type:"basic",order:2,productId:"289",productCode:"40c092161f547f8f72c9f173cd8eebcb9ca5dd25",proLicenseCount:3,monthly:{priceDisplayMonth:9,billAmount:27,save:36},yearly:{priceDisplayMonth:9,priceDisplayYear:99,billAmount:297,save:63},trialPeriod:14},{name:"Advanced",type:"advanced",order:3,productId:"290",productCode:"93b5595f0d7e4c04a3baba1102ffaecb17607bf4",proLicenseCount:11,monthly:{priceDisplayMonth:8,billAmount:88,save:264},yearly:{priceDisplayMonth:8,priceDisplayYear:88,billAmount:968,save:352},trialPeriod:14},{name:"Enterprise",type:"enterprise",order:4,productId:"301",productCode:"b1844725d63fde197f5125b58b6cba6260ee7a57",proLicenseCount:70,monthly:{priceDisplayMonth:7,billAmount:490,save:2520},yearly:{priceDisplayMonth:7,priceDisplayYear:77,billAmount:5390,save:3010}},{name:"Enterprise",type:"enterprisesub",order:5,productId:"303",productCode:"d521f5bfbc1eef109481eebb79831e11c7804ad8",proLicenseCount:0}]).factory("plansFactory",["$q","$log","$modal","$templateCache","getCompany","userState","subscriptionStatusService","storeAuthorization","PLANS_LIST",function(e,n,t,r,i,o,a,c,s){var l={},u=_.map(s,"productCode"),p=_.keyBy(s,"type"),d=_.keyBy(s,"productCode"),m=[p.free,p.starter,p.basic,p.advanced,p.enterprise];l.showPlansModal=function(){if(!l.isPlansModalOpen){l.isPlansModalOpen=!0;var e=t.open({template:r.get("plans/plans-modal.html"),controller:"PlansModalCtrl",windowClass:"pricing-component-modal"});e.result["finally"](function(){l.isPlansModalOpen=!1})}};var y=function(){return n.debug("getCompanyPlanStatus called."),a.list(u.slice(1),o.getSelectedCompanyId()).then(function(e){n.debug("getCompanyPlanStatus response.",e);var t=_.keyBy(e,"pc");return t})};return l.getPlansDetails=function(){var e=_.cloneDeep(m);return y().then(function(n){return e.forEach(function(e){var t=n[e.productCode]||e;e.status=t.status,e.statusCode=t.statusCode}),e})["catch"](function(e){n.debug("Failed to load plans",e)})},l.startTrial=function(e){return c.startTrial(e.productCode).then(function(){var n=o.getCopyOfSelectedCompany(!0),t=d[e.productCode].proLicenseCount;n.planProductCode=e.productCode,n.planTrialPeriod=e.trialPeriod,n.planSubscriptionStatus="Trial",n.playerProTotalLicenseCount=t,n.playerProAvailableLicenseCount=t,o.updateCompanySettings(n)})["catch"](function(e){throw n.debug("Failed to start trial",e),e})},l.startVolumePlanTrial=function(){return l.startTrial(p.volume)},l}])}(angular),angular.module("risevision.common.components.plans").directive("rvOn",function(){return{restrict:"A",link:function(e,n,t){var r=t.rvOn,i=r.split(":")[0],o=r.split(":")[1];n.on(i,function(n){e.$apply(e[o].bind(null,e,{$event:n}))})}}}).controller("PlansModalCtrl",["$scope","$rootScope","$modalInstance","$log","$loading","$timeout","getCompany","plansFactory","currentPlanFactory","ChargebeeFactory","userState","purchaseFactory","PLANS_LIST","CHARGEBEE_PLANS_USE_PROD",function(e,n,t,r,i,o,a,c,s,l,u,p,d,m){function y(){return f().then(function(n){e.pricingComponentDiscount=C.discountIndustries.includes(n)})}function f(){var e=window.top.location.href.match(/cid=([a-z0-9-]+)/),n=e?e[1]:null;return a(n).then(function(e){return e.companyIndustry})}function b(){return i.start("plans-modal"),c.getPlansDetails().then(function(n){e.plans=n})["finally"](function(){i.stop("plans-modal")})}function h(){var n=u.getCopyOfSelectedCompany();e.chargebeeFactory.openSubscriptionDetails(n.id,n.planSubscriptionId)}var C=d.filter(function(e){return"Volume"===e.name})[0];e.pricingAtLeastOneDisplay=!0,e.currentPlan=s.currentPlan,e.purchaseFactory=p,e.chargebeeFactory=new l,e.startTrialError=null,e.isMonthly=!0,e.pricingComponentDiscount=!1,e.useProductionChargebeeData="true"===m,e.isCurrentPlan=function(n){return e.currentPlan.type===n.type},e.isCurrentPlanSubscribed=function(n){return e.isCurrentPlan(n)&&e.isSubscribed(n)},e.isOnTrial=function(e){return"on-trial"===e.statusCode},e.isTrialAvailable=function(e){return"trial-available"===e.statusCode},e.isTrialExpired=function(e){return"trial-expired"===e.statusCode},e.isSubscribed=function(e){return"Subscribed"===e.status||"Active"===e.status},e.isFree=function(e){return"free"===e.type},e.isStarter=function(e){return"starter"===e.type},e.showSavings=function(n){return!(e.isFree(n)||e.isStarter(n)&&e.isMonthly)},e.currentPlanLabelVisible=function(n){return s.isPlanActive()?e.isCurrentPlan(n):e.isFree(n)},e.getVisibleAction=function(n){return s.isPlanActive()?e.isCurrentPlan(n)?e.isOnTrial(n)?"subscribe":"":e.currentPlan.order>n.order?s.isOnTrial()&&!e.isFree(n)?"downgrade":"downgrade-portal":s.isOnTrial()?"subscribe":"subscribe-portal":e.isFree(n)?"":e.isTrialAvailable(n)?"start-trial":"subscribe"},e.startTrial=function(a){i.start("plans-modal"),e.startTrialError=null,c.startTrial(a).then(function(){return o(1e4).then(function(){return u.reloadSelectedCompany()}).then(function(){n.$emit("risevision.company.trial.started")})["catch"](function(e){r.debug("Failed to reload company",e)})["finally"](function(){t.close(a)})})["catch"](function(n){e.startTrialError=n})["finally"](function(){i.stop("plans-modal")})},e.showPurchaseModal=function(n,t){p.showPurchaseModal(n,t).then(e.dismiss)},e.downgradePortal=h,e.subscribePortal=h,e.purchaseAdditionalLicenses=h,e.isChargebee=function(){return u.isSelectedCompanyChargebee()},e.refreshButton=function(){var n=document.querySelector("pricing-component");e.pricingAtLeastOneDisplay=n&&n.displayCount&&n.displayCount>0},e.dismissAndShowPurchaseModal=function(){var n=document.querySelector("pricing-component"),r=n.displayCount,i="yearly"===n.period?"Yearly":"Monthly",o=n.tierName,a=r>1?"s":"",c=""+r+" Display"+a+" ("+o+" Plan, "+i+")";0!==r&&"0"!==r&&(t.dismiss("cancel"),e.showPurchaseModal({name:c,productId:C.productId,productCode:C.productCode,displays:r,yearly:{billAmount:n.priceTotal},monthly:{billAmount:n.priceTotal}},"monthly"===n.period))},e.dismiss=function(){t.dismiss("cancel")},e.init=function(){b(),y()},e.init()}]),function(e){try{e=angular.module("risevision.common.components.plans")}catch(n){e=angular.module("risevision.common.components.plans",[])}e.run(["$templateCache",function(e){e.put("plans/plans-modal.html",'<div><button type="button" style="display: block; width: 100%; text-align: center; padding: 0.5em 0.5em 0 0; background: none; border: none; text-align: right" ng-click="dismiss()" aria-hidden="true"><i class="fa fa-lg fa-times" style="opacity: 0.4"></i></button><h3 style="font-weight: bold; text-align: center; margin-top: 0" translate="">common-header.plans.pricing-component-title</h3><div id="pricingComponentContainer"><pricing-component ng-attr-apply-discount="{{pricingComponentDiscount ? \'\' : undefined}}" ng-attr-prod-env="{{useProductionChargebeeData ? \'\' : undefined}}" rv-on="display-count-changed:refreshButton"></pricing-component><button type="button" ng-disabled="!pricingAtLeastOneDisplay" ng-click="dismissAndShowPurchaseModal()" id="subscribeButton">I Want To Subscribe</button></div></div>')}])}();