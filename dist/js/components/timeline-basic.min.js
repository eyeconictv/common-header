"use strict";angular.module("risevision.common.components.timeline-basic.services",[]),angular.module("risevision.common.components.timeline-basic",["risevision.common.components.timeline-basic.services","ui.bootstrap"]),angular.module("risevision.common.components.timeline-basic.services").factory("timelineBasicDescription",["$filter",function(e){var i={},n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t=function(i,n,t){var l="",a=new Date(i);return n?(a.setMinutes(a.getMinutes()+a.getTimezoneOffset()),l=e("date")(a,t)):l=e("date")(a,t),l};return i.updateLabel=function(e){var i="",l=[];if(e.allDay)i="All day ";else if(e.startTime){var a="hh:mm a";i=i+t(e.startTime,e.useLocaldate,a)+" ",e.endTime&&(i=i+"to "+t(e.endTime,e.useLocaldate,a)+" ")}if(e.recurrenceDaysOfWeek)for(var r=0;r<e.recurrenceDaysOfWeek.length;r++)"Mon"===e.recurrenceDaysOfWeek[r]?l.push(n[1]):"Tue"===e.recurrenceDaysOfWeek[r]?l.push(n[2]):"Wed"===e.recurrenceDaysOfWeek[r]?l.push(n[3]):"Thu"===e.recurrenceDaysOfWeek[r]?l.push(n[4]):"Fri"===e.recurrenceDaysOfWeek[r]?l.push(n[5]):"Sat"===e.recurrenceDaysOfWeek[r]?l.push(n[6]):"Sun"===e.recurrenceDaysOfWeek[r]&&l.push(n[0]);return e.everyDay||0===l.length||7===l.length?i+="every day":l.length>0&&(i=i+"every "+l.join(" ")),i},i}]),angular.module("risevision.common.components.timeline-basic.services").factory("TimelineBasicFactory",[function(){var e=function(e,i,n){var t=new Date;return n?t=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),e,i,0)):(t.setHours(e),t.setMinutes(i),t.setSeconds(0),t=t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")),t},i=function(i){var n=i,t={weekly:{}},l=function(){if(n.recurrenceDaysOfWeek)for(var e=0;e<n.recurrenceDaysOfWeek.length;e++)"Mon"===n.recurrenceDaysOfWeek[e]?t.weekly.monday=!0:"Tue"===n.recurrenceDaysOfWeek[e]?t.weekly.tuesday=!0:"Wed"===n.recurrenceDaysOfWeek[e]?t.weekly.wednesday=!0:"Thu"===n.recurrenceDaysOfWeek[e]?t.weekly.thursday=!0:"Fri"===n.recurrenceDaysOfWeek[e]?t.weekly.friday=!0:"Sat"===n.recurrenceDaysOfWeek[e]?t.weekly.saturday=!0:"Sun"===n.recurrenceDaysOfWeek[e]&&(t.weekly.sunday=!0)},a=function(){n.allDay&&(n.startTime=e(8,0,n.useLocaldate),n.endTime=e(17,30,n.useLocaldate)),l()};a();var r=function(){var e=[];i.everyDay||(t.weekly.monday&&e.push("Mon"),t.weekly.tuesday&&e.push("Tue"),t.weekly.wednesday&&e.push("Wed"),t.weekly.thursday&&e.push("Thu"),t.weekly.friday&&e.push("Fri"),t.weekly.saturday&&e.push("Sat"),t.weekly.sunday&&e.push("Sun")),n.recurrenceDaysOfWeek=e,n.everyDay=0===e.length||7===e.length};this.save=function(){n.startTime=n.allDay?null:n.startTime,n.endTime=n.allDay?null:n.endTime,r()},this.timeline=n,this.recurrence=t};return i.getTimeline=function(e,i,n,t){var l=(t||[]).length,a=!i&&!n,r=0===l||7===l,c={useLocaldate:e,always:a&&r,allDay:a,everyDay:r,startTime:i||null,endTime:n||null,recurrenceDaysOfWeek:t||[]};return c},i}]),function(e){e.module("risevision.common.components.timeline-basic").directive("timelineBasicTextbox",["$modal","$filter","TimelineBasicFactory","timelineBasicDescription",function(i,n,t,l){return{restrict:"E",scope:{timelineString:"=",ngDisabled:"="},templateUrl:"timeline-basic/timeline-textbox.html",link:function(a){var r=!1,c=!1;a.monitoringSchedule={},a.$watch("timelineString",function(){r||c?(r=!1,c=!1):(a.monitoringSchedule=a.parseTimeline(a.timelineString),a.timeline=t.getTimeline(a.monitoringSchedule.useLocaldate,a.monitoringSchedule.startTime,a.monitoringSchedule.endTime,a.monitoringSchedule.recurrenceDaysOfWeek),a.timeline.label=l.updateLabel(a.timeline))}),a.$watch("timeline.always",function(e){r||(c=!0,a.monitoringSchedule.timeDefined=!e,a.timelineString=a.formatTimeline(a.monitoringSchedule))}),a.openModal=function(){if(!a.ngDisabled){var n=i.open({templateUrl:"timeline-basic/timeline-modal.html",controller:"timelineBasicModal",resolve:{timeline:function(){return e.copy(a.timeline)}},size:"md"});n.result.then(function(e){r=!0,a.timeline=e,a.timeline.always=e.allDay&&e.everyDay,a.monitoringSchedule.timeDefined=!a.timeline.always,a.monitoringSchedule.startTime=e.startTime,a.monitoringSchedule.endTime=e.endTime,a.monitoringSchedule.recurrenceDaysOfWeek=e.recurrenceDaysOfWeek,a.timeline.label=l.updateLabel(a.timeline),a.timelineString=a.formatTimeline(a.monitoringSchedule)},function(){})}},a.formatTimeline=function(e){var i={};return e&&e.timeDefined?((e.startTime||e.endTime)&&(i.time={},i.time.start=e.startTime?n("date")(new Date(e.startTime),"HH:mm"):null,i.time.end=e.endTime?n("date")(new Date(e.endTime),"HH:mm"):null),e.recurrenceDaysOfWeek&&e.recurrenceDaysOfWeek.length>0&&(i.week=e.recurrenceDaysOfWeek.map(function(e){return{day:e,active:!0}})),i=JSON.stringify(i),"{}"!==i?i:null):null},a.parseTimeline=function(e){var i={};return e&&"{}"!==e&&(e=JSON.parse(e),i.timeDefined=!0,e.time&&(i.startTime=e.time.start?a.reformatTime(e.time.start):null,i.endTime=e.time.end?a.reformatTime(e.time.end):null),e.week&&(i.recurrenceDaysOfWeek=[],e.week.forEach(function(e){e.active&&i.recurrenceDaysOfWeek.push(e.day)}))),i},a.reformatTime=function(e){var i=n("date")(new Date,"dd MMM yyyy"),t=new Date(i+" "+e);return n("date")(t,"dd MMM yyyy hh:mm a")}}}}])}(angular),function(e){e.module("risevision.common.components.timeline-basic").controller("timelineBasicModal",["$scope","$modalInstance","timeline","TimelineBasicFactory",function(e,i,n,t){var l=new t(n);e.recurrence=l.recurrence,e.timeline=l.timeline,e.save=function(){l.save(),i.close(e.timeline)},e.close=function(){i.dismiss()}}])}(angular),function(e){try{e=angular.module("risevision.common.components.timeline-basic")}catch(i){e=angular.module("risevision.common.components.timeline-basic",[])}e.run(["$templateCache",function(e){e.put("timeline-basic/timeline-modal.html",'<div id="timelineModal"><div class="modal-header"><button type="button" class="close" ng-click="close()" aria-hidden="true"><i class="fa fa-times"></i></button><h3 class="modal-title">Edit Timeline</h3></div><div class="modal-body" stop-event="touchend"><form role="form" name="timelineDetails" novalidate=""><div class="timeline"><section><label class="control-label u_margin-sm-bottom"><input type="checkbox" ng-model="timeline.allDay"> <strong>All Day</strong> <a href="https://help.risevision.com/hc/en-us/articles/360000382486" target="_blank"><i class="fa fa-question-circle icon-right" aria-hidden="true"></i></a></label><div class="row form-group" ng-hide="timeline.allDay"><div class="col-sm-4"><label class="control-label">Start Time (UTC)</label><div class="time-picker"><timepicker id="startTime" ng-model="timeline.startTime" ng-change="changed()" hour-step="1" minute-step="15" show-meridian="true" datepicker-localdate="{{timeline.useLocaldate}}"></timepicker></div></div><div class="col-sm-4"><label class="control-label">End Time (UTC)</label><div class="time-picker"><timepicker id="endTime" ng-model="timeline.endTime" ng-change="changed()" hour-step="1" minute-step="15" show-meridian="true" datepicker-localdate="{{timeline.useLocaldate}}"></timepicker></div></div></div></section><section><label class="control-label u_margin-sm-bottom"><input type="checkbox" ng-model="timeline.everyDay"> <strong>Every Day</strong></label><div class="recurrence-option" ng-hide="timeline.everyDay"><div class="form-group timelineWeekdays"><label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.monday"> Monday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.tuesday"> Tuesday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.wednesday"> Wednesday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.thursday"> Thursday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.friday"> Friday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.saturday"> Saturday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.sunday"> Sunday</label></div></div></section></div></form></div><div class="modal-footer"><button type="button" class="btn btn-primary btn-fixed-width" ng-click="save()" ng-disabled="timelineDetails.$invalid">Apply <i class="fa fa-white fa-check icon-right"></i></button> <button type="button" class="btn btn-default btn-fixed-width" ng-click="close()">Cancel <i class="fa fa-times icon-right"></i></button></div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.timeline-basic")}catch(i){e=angular.module("risevision.common.components.timeline-basic",[])}e.run(["$templateCache",function(e){e.put("timeline-basic/timeline-textbox.html",'<label class="control-label control-label-secondary u_margin-left"><input ng-model="timeline.always" type="checkbox" ng-disabled="ngDisabled"> Always</label><div id="timelineTextbox" class="panel-editable u_remove-bottom u_clickable" ng-class="{ \'panel-disabled\': ngDisabled }" ng-click="openModal()" ng-show="!timeline.always"><div class="label label-tag"><span id="timelineLabel" timeline="timeline">{{timeline.label}}</span></div></div>')}])}();