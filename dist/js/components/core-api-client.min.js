"use strict";angular.module("risevision.common.apis",["risevision.common.gapi"]).factory("listApis",["$q","discoveryAPILoader","$log",function(e,r,t){return function(o,n){t.debug("listApis called",o,n);var i=e.defer();return r().then(function(e){var r={};o&&(r.name=o),n&&(r.preferred=n);var a=e.apis.list(r);a.execute(function(e){t.debug("listApis resp",e),e.result?i.resolve(e.items):i.reject(e)})}),i.promise}}]).factory("getRest",["$q","discoveryAPILoader","$log",function(e,r,t){return function(o,n){t.debug("getRest called",o,n);var i=e.defer();return r().then(function(e){var r={};o&&(r.api=o),n&&(r.version=n);var a=e.apis.getRest(r);a.execute(function(e){t.debug("getRest resp",e),e.result?i.resolve(e):i.reject(e)})}),i.promise}}]),angular.module("risevision.common.app",["risevision.common.gapi","risevision.core.util"]).constant("APP_WRITABLE_FIELDS",["name","description","clientId","url"]).factory("listApps",["$q","riseAPILoader","$log",function(e,r,t){return function(o){t.debug("listApps called",o);var n=e.defer();return r().then(function(e){var r={};o&&(r.companyId=o);var i=e.app.list(r);i.execute(function(e){t.debug("listApps resp",e),e.result?n.resolve(e.items):n.reject(e)})}),n.promise}}]).factory("getApp",["$q","riseAPILoader","$log",function(e,r,t){return function(o){t.debug("getApp called",o);var n=e.defer();return r().then(function(e){var r={};o&&(r.id=o);var i=e.app.get(r);i.execute(function(e){t.debug("getApp resp",e),e.result?n.resolve(e.item):n.reject(e)})}),n.promise}}]).factory("createApp",["$q","riseAPILoader","$log","pick","APP_WRITABLE_FIELDS",function(e,r,t,o,n){return function(i,a,u){t.debug("createApp called",i,a,u);var c=e.defer();return r().then(function(e){var r=o.apply(this,[u].concat(n)),t=e.app.add({companyId:i,userId:a,data:JSON.stringify(r)});t.execute(function(e){e.result?c.resolve(e.item):c.reject(e)},c.reject)}),c.promise}}]).factory("updateApp",["$q","riseAPILoader","$log","pick","APP_WRITABLE_FIELDS",function(e,r,t,o,n){return function(i,a){t.debug("updateApp called",i,a);var u=e.defer();return r().then(function(e){var r=o.apply(this,[a].concat(n)),t=e.app.update({id:i,data:JSON.stringify(r)});t.execute(function(e){e.result?u.resolve(e.item):u.reject(e)},u.reject)}),u.promise}}]).factory("deleteApp",["$q","riseAPILoader","$log",function(e,r,t){return function(o){t.debug("deleteApp called",o);var n=e.defer();return r().then(function(e){var r={};o&&(r.id=o);var i=e.app["delete"](r);i.execute(function(e){t.debug("deleteApp resp",e),e.result?n.resolve(e.item):n.reject(e)})}),n.promise}}]),function(e){e.module("risevision.core.cache",[]).factory("userInfoCache",["$cacheFactory",function(e){return e("user-info-cache")}])}(angular),angular.module("risevision.common.core.endpoint",["risevision.common.gapi"]).factory("callEndpoint",["coreAPILoader","$q","$log",function(coreAPILoader,$q,$log){return function(method,criteria){$log.debug("Endpoint called",method,criteria);var deferred=$q.defer();return coreAPILoader().then(function(core){var request=eval(method)(criteria);request.execute(function(e){$log.debug("Endpoint resp",e),e.result?deferred.resolve(e):deferred.reject(e)})}),deferred.promise}}]),function(e){e.module("risevision.core.company",["risevision.common.gapi","risevision.core.cache","risevision.core.util"]).constant("COMPANY_WRITABLE_FIELDS",["name","street","unit","city","province","country","postalCode","timeZoneOffset","telephone","fax","companyStatus","mailSyncEnabled","sellerId","isTest","shipToUseCompanyAddress","shipToName","shipToStreet","shipToUnit","shipToCity","shipToProvince","shipToPostalCode","shipToCountry","website","companySize","companyIndustry","billingContactEmails"]).constant("ALERTS_WRITABLE_FIELDS",["alertSettings"]).constant("COMPANY_SEARCH_FIELDS",["name","id","street","unit","city","province","country","postalCode","telephone","fax","shipToName","shipToStreet","shipToCity","shipToPostalCode"]).factory("company",["$q","$log","coreAPILoader","pick","ALERTS_WRITABLE_FIELDS",function(e,r,t,o,n){var i={updateAlerts:function(i,a){var u=e.defer(),c=o.apply(this,[a].concat(n)),s={id:i,data:c};return r.debug("updateAlerts called",i,c),t().then(function(e){return e.company.patch(s)}).then(function(e){r.debug("update Alerts resp",e),u.resolve(e.result)}).then(null,function(e){r.error("Failed to update Alerts.",e),u.reject(e)}),u.promise}};return i}]).factory("createCompany",["$q","coreAPILoader","COMPANY_WRITABLE_FIELDS","pick",function(e,r,t,o){return function(n,i){var a=e.defer();return r().then(function(e){var r=o.apply(this,[i].concat(t)),u=e.company.add({parentId:n,data:r});u.execute(function(e){e.result?a.resolve(e.item):a.reject(e)},a.reject)}),a.promise}}]).factory("getCompany",["coreAPILoader","$q","$log",function(e,r,t){return function(o){t.debug("getCompany called",o);var n=r.defer();return e().then(function(e){var r={};o&&(r.id=o);var i=e.company.get(r);i.execute(function(e){t.debug("getCompany resp",e),e.result?n.resolve(e.item):n.reject(e)})}),n.promise}}]).factory("lookupCompany",["coreAPILoader","$q","$log",function(e,r,t){return function(o){t.debug("lookupCompany called",o);var n=r.defer();return e().then(function(e){var r=e.company.lookup({authKey:o});r.execute(function(e){t.debug("lookupCompany resp",e),e.result?n.resolve(e.item):n.reject(e)})}),n.promise}}]).factory("moveCompany",["coreAPILoader","$q","$log",function(e,r,t){return function(o,n){var i=r.defer();return e().then(function(e){var r=e.company.move({authKey:o,newParentId:n});r.execute(function(e){t.debug("moveCompany resp",e),e.result?i.resolve(e.item):i.reject(e)})}),i.promise}}]).factory("updateCompany",["$q","$log","coreAPILoader","pick","COMPANY_WRITABLE_FIELDS",function(e,r,t,o,n){return function(i,a){var u=e.defer();return a=o.apply(this,[a].concat(n)),r.debug("updateCompany called",i,a),t().then(function(e){var t=e.company.patch({id:i,data:a});t.execute(function(e){r.debug("updateCompany resp",e),e.result?u.resolve(e):u.reject(e)})}),u.promise}}]).factory("regenerateCompanyField",["$q","$log","coreAPILoader",function(e,r,t){return function(o,n){var i=e.defer();return r.debug("regenerateField called",o,n),t().then(function(e){var t=e.company.regenerateField({id:o,fieldName:n});t.execute(function(e){r.debug("regenerateField resp",e),e.error?i.reject(e.message):i.resolve(e)},function(e){i.reject("call failed "+e)})}),i.promise}}]).factory("deleteCompany",["coreAPILoader","$q","$log",function(e,r,t){return function(o){t.debug("deleteCompany called",o);var n=r.defer();return e().then(function(e){var r={};o&&(r.id=o);var i=e.company["delete"](r);i.execute(function(e){t.debug("deleteCompany resp",e),e.result?n.resolve(e.item):n.reject(e)})}),n.promise}}]).service("companyService",["coreAPILoader","$q","$log","getCompany","COMPANY_SEARCH_FIELDS",function(e,r,t,o,n){var i=function(e,r){for(var t="",o=0;o<e.length;o++)t+="OR "+e[o]+":~'"+r+"' ";return t=t?t.substring(3):"",t.trim()};this.getCompanies=function(o,a){var u=r.defer(),c=o.query?i(n,o.query):"",s={companyId:o.companyId,search:c,cursor:a,count:o.count,sort:o.sortBy+(o.reverse?" desc":" asc")};return t.debug("getCompanies called with",s),e().then(function(e){var r=e.company.list(s);r.execute(function(e){t.debug("getCompanies resp",e),u.resolve(e)})}),u.promise},this.loadSelectedCompany=function(e,t){var n=r.defer();return e&&e!==t.id?o(e).then(function(e){0===e.code&&e.item?n.resolve(e.item):n.resolve(t)}):n.resolve(t),n.promise}}]).factory("enableCompanyProduct",["$q","$log","coreAPILoader",function(e,r,t){return function(o,n,i){var a=e.defer();return r.debug("enableCompanyProduct called",o,n,i),t().then(function(e){var t=e.company.enableProduct({id:o,productCode:n,data:i});t.execute(function(e){r.debug("enableCompanyProduct resp",e),e.result?a.resolve(e):a.reject(e)})}),a.promise}}]).filter("fullAddress",function(){return function(e){var r=(e.street?e.street+", ":"")+(e.city?e.city+", ":"")+(e.province?e.province+", ":"")+(e.country?e.country+", ":"")+(e.postalCode?e.postalCode+", ":"");return r&&(r=r.substr(0,r.length-2)),r}})}(angular),function(e){e.module("risevision.core.util",[]).factory("pick",function(){var r=Array.prototype,t=r.slice,o=r.concat,n=function(e,r,t){if(void 0===r)return e;switch(null===t?3:t){case 1:return function(t){return e.call(r,t)};case 2:return function(t,o){return e.call(r,t,o)};case 3:return function(t,o,n){return e.call(r,t,o,n)};case 4:return function(t,o,n,i){return e.call(r,t,o,n,i)}}return function(){return e.apply(r,arguments)}};return function(r,i,a){var u,c={};if(null===r)return c;if(e.isFunction(i)){i=n(i,a);for(u in r){var s=r[u];i(s,u,r)&&(c[u]=s)}}else{var l=o.apply([],t.call(arguments,1));r=new Object(r);for(var d=0,p=l.length;d<p;d++)u=l[d],u in r&&(c[u]=r[u])}return c}})}(angular),function(e){e.module("risevision.core.countries",["risevision.common.gapi"]).factory("getCoreCountries",["coreAPILoader","$q","$log","$filter",function(e,r,t,o){var n;return function(){return n?n.promise:(n=r.defer(),e().then(function(e){return e.country.list()}).then(function(e){var r=e.result?e.result.items:[];r instanceof Array&&(r=o("orderBy")(r,"name")),n.resolve(r)}).then(null,function(e){t.debug("getCoreCountries failed",e),n.reject(e),n=null}),n.promise)}}]).factory("COUNTRIES",["getCoreCountries",function(e){var r=[];return e().then(function(e){Array.prototype.push.apply(r,e)}),r}])}(angular),function(e){e.module("risevision.core.display",["risevision.common.gapi","risevision.core.cache","risevision.core.util"]).service("displayService",["coreAPILoader","$q","$log",function(e,r,t){this.list=function(o,n,i,a,u){var c=r.defer(),s={companyId:o,search:n,cursor:i,count:a,sort:u};return t.debug("list displays called with",s),e().then(function(e){var r=e.display.list(s);r.execute(function(e){t.debug("list displays resp",e),e.result?c.resolve(e.items):c.reject(e)})}),c.promise}}])}(angular),angular.module("risevision.common.fastpass",[]).factory("loadFastpass",["$q","$http","$document","$timeout","GSFP_URL","$log",function(e,r,t,o,n,i){var a=function(r){var o=e.defer(),n=t[0].createElement("script");return n.onload=n.onreadystatechange=function(e){o.resolve(e)},n.onerror=function(e){o.reject(e)},n.src=r,t&&t[0]&&t[0].body.appendChild(n),o.promise};return function(t,o){var u=e.defer();i.debug("loadFastpass called",t,o);var c=function(e){i.error("loadFastpass rejected",e),u.reject("loadFastpass rejected "+e)};return r.get(n+"/geturl?userEmail="+o+"&userName="+t).then(function(e){a(e.data).then(function(e){i.debug("loadFastpass result",e),u.resolve(!0)},c)["catch"](c)},u.reject),u.promise}}]),angular.module("risevision.common.monitoring.activity",["risevision.common.gapi"]).factory("getActivity",["$q","monitoringAPILoader","$log",function(e,r,t){return function(o,n){t.debug("getActivity called",o,n);var i=e.defer();return r().then(function(e){var r={};o&&(r.clientId=o),n&&(r.api=n);var a=e.activity.get(r);a.execute(function(e){t.debug("getActivity resp",e),e.result?i.resolve(e.result):i.reject(e)})},function(e){t.debug("Error: "+e),i.reject(e)}),i.promise}}]),function(e){e.module("risevision.core.oauth2",["risevision.common.gapi","risevision.core.cache"]).factory("getOAuthUserInfo",["oauth2APILoader","$q","userInfoCache","$log",function(e,r,t,o){return function(){var n,i=r.defer();return(n=t.get("oauth2UserInfo"))?n.error?i.reject(n.error):i.resolve(n):e().then(function(e){e.userinfo.get().execute(function(e){o.debug("getOAuthUserInfo oauth2.userinfo.get() resp",e),e?e.hasOwnProperty("error")?(t.remove("oauth2UserInfo"),i.reject(e.error)):(t.put("oauth2UserInfo",e),i.resolve(e)):(t.remove("oauth2UserInfo"),i.reject())})},i.reject),i.promise}}])}(angular),function(e){e.module("risevision.core.schedule",["risevision.common.gapi","risevision.core.cache","risevision.core.util"]).service("scheduleService",["coreAPILoader","$q","$log",function(e,r,t){this.list=function(o,n,i,a,u){var c=r.defer(),s={companyId:o,search:n,cursor:i,count:a,sort:u};return t.debug("getSchedules called with",s),e().then(function(e){var r=e.schedule.list(s);r.execute(function(e){t.debug("getSchedules resp",e),e.result?c.resolve(e.items):c.reject(e)})}),c.promise}}])}(angular),angular.module("risevision.store.authorization",["risevision.common.gapi"]).factory("storeAuthorization",["$q","$log","$http","STORE_SERVER_URL","userState",function(e,r,t,o,n){var i={};return i.check=function(i){var a=e.defer();return t({url:o+"/v1/widget/auth",method:"GET",params:{cid:n.getSelectedCompanyId(),pc:i,startTrial:!1}}).then(function(e){e.data.authorized?a.resolve(!0):a.reject(!1)},function(e){r.error("Failed to check store authorization.",e),a.reject(e)}),a.promise},i.startTrial=function(i){var a=e.defer(),u=n.getSelectedCompanyId(),c="/v1/product/"+i+"/company/"+u+"/trial/start";return t.get(o+c).then(function(e){e.error?a.reject(e):a.resolve(!0)},function(e){r.error("Failed to start trial.",e),a.reject(e)}),a.promise},i}]),function(){angular.module("risevision.common.subscription-status",["risevision.common.gapi"]).service("subscriptionStatusService",["$http","$q","storeAPILoader","$log",function(e,r,t,o){function n(e,r){return Math.floor((r.getTime()-e.getTime())/u)}var i=["On Trial","Trial Expired","Subscribed","Suspended","Cancelled","Free","Not Subscribed","Product Not Found","Company Not Found","Error"],a=["on-trial","trial-expired","subscribed","suspended","cancelled","free","not-subscribed","product-not-found","company-not-found","error"],u=864e5;this.get=function(e,u){var c=r.defer(),s={companyId:u,productCodes:e};return t().then(function(e){var r=e.product.status(s);r.execute(function(e){if(o.debug("getProductStatus resp",e),e.result){var r=e.items[0];r.plural="";var t=i.indexOf(r.status);t>=0&&(r.statusCode=a[t]),""===r.status?(r.status="N/A",r.statusCode="na",r.subscribed=!1):r.status===i[0]||r.status===i[2]||r.status===i[5]?r.subscribed=!0:r.subscribed=!1,"not-subscribed"===r.statusCode&&r.trialPeriod&&r.trialPeriod>0&&(r.statusCode="trial-available",r.subscribed=!0),r.expiry&&"on-trial"===r.statusCode&&(r.expiry=new Date(r.expiry),r.expiry instanceof Date&&!isNaN(r.expiry.valueOf())&&(r.expiry=n(new Date,r.expiry)),0===r.expiry?r.plural="-zero":r.expiry>1&&(r.plural="-many")),c.resolve(r)}else c.reject(e)})}),c.promise}}])}(),function(e){e.module("risevision.core.systemmessages",["risevision.common.gapi"]).factory("getCoreSystemMessages",["gapiLoader","$q","$log",function(e,r,t){return function(o){var n=r.defer();return e().then(function(e){var r=e.client.core.systemmessage.list({companyId:o});r.execute(function(e){var r=e;r instanceof Array||!r.items||(r=r.items),t.debug("getCoreSystemMessage resp",r),n.resolve(r)})}),n.promise}}])}(angular),function(e){e.module("risevision.core.userprofile",["risevision.common.gapi","risevision.core.oauth2"]).value("userRoleMap",{ce:"Content Editor",cp:"Content Publisher",da:"Display Administrator",ua:"System Administrator",pu:"Store Purchaser",sa:"Rise System Administrator",ba:"Rise Store Administrator"}).constant("USER_WRITABLE_FIELDS",["mailSyncEnabled","email","firstName","lastName","telephone","roles","status","companyRole","dataCollectionDate"]).factory("getUserProfile",["oauth2APILoader","coreAPILoader","$q","$log",function(e,r,t,o){var n,i={};return function(a,u){var c;if(a===n&&!u&&null!==i[a])return i[a].promise;if(n=a,i[a]=c=t.defer(),a){var s={};a&&(s.username=a),o.debug("getUserProfile called",s),t.all([e(),r()]).then(function(e){var r=e[1];r.user.get(s).execute(function(e){e.error||!e.result?c.reject(e):(o.debug("getUser resp",e),c.resolve(e.item))})},c.reject)}else c.reject("getUserProfile failed: username param is required."),o.debug("getUserProfile failed: username param is required.");return c.promise}}]).factory("updateUser",["$q","coreAPILoader","$log","getUserProfile","pick","USER_WRITABLE_FIELDS",function(e,r,t,o,n,i){return function(a,u){var c=e.defer();return u=n(u,i),t.debug("updateUser called",a,u),r().then(function(e){var r=e.user.patch({username:a,data:u});r.execute(function(e){t.debug("updateUser resp",e),e.error?c.reject(e):e.result?o(a,!0).then(function(){c.resolve(e)}):c.reject("updateUser")})},c.reject),c.promise}}]).factory("addUser",["$q","coreAPILoader","$log","pick","getUserProfile",function(e,r,t,o,n){return function(i,a,u){var c=e.defer();return r().then(function(e){u=o(u,"mailSyncEnabled","email","firstName","lastName","telephone","roles","status");var r=e.user.add({username:a,companyId:i,data:u});r.execute(function(e){t.debug("addUser resp",e),e.result?n(a,!0).then(function(){c.resolve(e)}):c.reject(e)})}),c.promise}}]).factory("deleteUser",["$q","coreAPILoader","$log",function(e,r,t){return function(o){var n=e.defer();return r().then(function(e){var r=e.user["delete"]({username:o});r.execute(function(e){t.debug("deleteUser resp",e),e.result?n.resolve(e):n.reject("deleteUser")})}),n.promise}}]).factory("getUsers",["$q","coreAPILoader","$log",function(e,r,t){return function(o,n){var i={companyId:o.companyId,search:o.query,cursor:n,count:o.count,sort:o.sortBy+(o.reverse?" desc":" asc")};t.debug("getUsers",i);var a=e.defer();return r().then(function(e){var r=e.user.list(i);r.execute(function(e){t.debug("getUsers resp",e),e.result?a.resolve(e.result):a.reject("getUsers")})},a.reject),a.promise}}])}(angular);